<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sprite Sheet Viewer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #1a1a2e;
            color: #e0e0e0;
            font-family: 'Segoe UI', system-ui, sans-serif;
            min-height: 100vh;
            display: flex;
        }

        /* Main Layout */
        .container {
            display: flex;
            width: 100%;
            height: 100vh;
        }

        /* Preview Panel - Left Side */
        .preview-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #0f0f1a;
            position: relative;
        }

        .preview-canvas {
            background:
                linear-gradient(45deg, #222 25%, transparent 25%),
                linear-gradient(-45deg, #222 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #222 75%),
                linear-gradient(-45deg, transparent 75%, #222 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            background-color: #1a1a1a;
            border: 2px solid #333;
            border-radius: 8px;
        }

        .preview-info {
            margin-top: 20px;
            text-align: center;
            font-family: monospace;
            color: #888;
        }

        .preview-info .action-name {
            font-size: 24px;
            color: #f1c40f;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 4px;
        }

        .preview-info .frame-num {
            font-size: 14px;
            margin-top: 8px;
        }

        /* Sprite Sheet Overview */
        .sheet-overview {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #333;
        }

        .sheet-overview img {
            max-width: 200px;
            height: auto;
            image-rendering: pixelated;
            opacity: 0.7;
        }

        .sheet-overview .highlight {
            position: absolute;
            border: 2px solid #f1c40f;
            pointer-events: none;
            box-shadow: 0 0 10px rgba(241, 196, 15, 0.5);
        }

        /* Controls Panel - Right Side */
        .controls-panel {
            width: 350px;
            background: #16213e;
            padding: 30px;
            overflow-y: auto;
            border-left: 1px solid #333;
        }

        .controls-panel h1 {
            font-size: 18px;
            color: #f1c40f;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid #333;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* Control Groups */
        .control-group {
            margin-bottom: 25px;
        }

        .control-group label {
            display: block;
            font-size: 11px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .control-group .value {
            float: right;
            color: #f1c40f;
            font-family: monospace;
        }

        /* Sliders */
        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            background: #0f0f1a;
            border-radius: 3px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: #f1c40f;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(241, 196, 15, 0.5);
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            background: #f39c12;
            transform: scale(1.1);
        }

        /* Number inputs */
        input[type="number"] {
            width: 100%;
            padding: 10px;
            background: #0f0f1a;
            border: 1px solid #333;
            border-radius: 4px;
            color: #fff;
            font-family: monospace;
            font-size: 14px;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: #f1c40f;
        }

        /* Buttons */
        .btn-group {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            background: #0f0f1a;
            border: 1px solid #333;
            border-radius: 4px;
            color: #fff;
            cursor: pointer;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.2s;
        }

        .btn:hover {
            background: #1a1a2e;
            border-color: #f1c40f;
        }

        .btn.active {
            background: #f1c40f;
            color: #000;
            border-color: #f1c40f;
        }

        /* Playback controls */
        .playback-controls {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }

        .playback-btn {
            flex: 1;
            padding: 15px;
            background: #0f0f1a;
            border: 1px solid #333;
            border-radius: 4px;
            color: #fff;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.2s;
        }

        .playback-btn:hover {
            background: #1a1a2e;
            border-color: #f1c40f;
        }

        .playback-btn.playing {
            background: #27ae60;
            border-color: #27ae60;
        }

        /* Section dividers */
        .section-title {
            font-size: 12px;
            color: #555;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin: 30px 0 15px 0;
            padding-top: 20px;
            border-top: 1px solid #333;
        }

        /* File input */
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-input-btn {
            display: block;
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #f1c40f 0%, #f39c12 100%);
            border: none;
            border-radius: 4px;
            color: #000;
            font-weight: bold;
            text-align: center;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Export section */
        .export-values {
            background: #0f0f1a;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            color: #888;
            margin-top: 10px;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .export-values .key {
            color: #f1c40f;
        }

        .export-values .val {
            color: #2ecc71;
        }

        /* Frame strip */
        .frame-strip {
            display: flex;
            gap: 5px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .frame-thumb {
            width: 50px;
            height: 50px;
            background: #0f0f1a;
            border: 2px solid #333;
            border-radius: 4px;
            cursor: pointer;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .frame-thumb.active {
            border-color: #f1c40f;
            box-shadow: 0 0 10px rgba(241, 196, 15, 0.3);
        }

        .frame-thumb canvas {
            image-rendering: pixelated;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Preview Panel -->
        <div class="preview-panel">
            <canvas id="preview" class="preview-canvas" width="256" height="256"></canvas>
            <div class="preview-info">
                <div class="action-name" id="actionName">IDLE</div>
                <div class="frame-num">Frame <span id="frameNum">0</span> / <span id="totalFrames">4</span></div>
            </div>

            <!-- Sprite sheet overview -->
            <div class="sheet-overview" id="sheetOverview" style="display: none;">
                <img id="sheetThumb" src="">
                <div class="highlight" id="frameHighlight"></div>
            </div>
        </div>

        <!-- Controls Panel -->
        <div class="controls-panel">
            <h1>Sprite Viewer</h1>

            <!-- File loader -->
            <div class="control-group">
                <div class="file-input-wrapper">
                    <div class="file-input-btn">üìÅ Load Sprite Sheet</div>
                    <input type="file" id="fileInput" accept="image/*">
                </div>
            </div>

            <!-- Grid Settings -->
            <div class="section-title">Grid Layout</div>

            <div class="control-group">
                <label>Columns <span class="value" id="colsValue">4</span></label>
                <input type="range" id="cols" min="1" max="12" value="4">
            </div>

            <div class="control-group">
                <label>Rows <span class="value" id="rowsValue">3</span></label>
                <input type="range" id="rows" min="1" max="12" value="3">
            </div>

            <!-- Row Selection -->
            <div class="section-title">Animation Row</div>
            <div class="btn-group" id="rowButtons">
                <button class="btn active" data-row="0">Idle</button>
                <button class="btn" data-row="1">Run</button>
                <button class="btn" data-row="2">Jump</button>
            </div>

            <!-- Frame strip -->
            <div class="frame-strip" id="frameStrip"></div>

            <!-- Playback -->
            <div class="section-title">Playback</div>

            <div class="control-group">
                <label>Speed (ms per frame) <span class="value" id="speedValue">150</span></label>
                <input type="range" id="speed" min="50" max="500" value="150" step="10">
            </div>

            <div class="playback-controls">
                <button class="playback-btn" id="prevFrame">‚èÆ</button>
                <button class="playback-btn" id="playPause">‚ñ∂</button>
                <button class="playback-btn" id="nextFrame">‚è≠</button>
            </div>

            <!-- Display -->
            <div class="section-title">Display</div>

            <div class="control-group">
                <label>Scale <span class="value" id="scaleValue">4x</span></label>
                <input type="range" id="scale" min="1" max="10" value="4">
            </div>

            <div class="control-group">
                <label>Offset X <span class="value" id="offsetXValue">0</span></label>
                <input type="range" id="offsetX" min="-50" max="50" value="0">
            </div>

            <div class="control-group">
                <label>Offset Y <span class="value" id="offsetYValue">0</span></label>
                <input type="range" id="offsetY" min="-50" max="50" value="0">
            </div>

            <!-- Export -->
            <div class="section-title">Export Config</div>
            <div class="export-values" id="exportValues">
                Load a sprite sheet to see config...
            </div>

            <div class="btn-group" style="margin-top: 15px;">
                <button class="btn" id="copyConfig">üìã Copy Config</button>
            </div>
        </div>
    </div>

    <script>
// =============================================================================
// SPRITE VIEWER
// =============================================================================

const preview = document.getElementById('preview');
const ctx = preview.getContext('2d');
ctx.imageSmoothingEnabled = false;

let spriteSheet = null;
let currentRow = 0;
let currentFrame = 0;
let isPlaying = false;
let playInterval = null;

// Settings
let cols = 4;
let rows = 3;
let speed = 150;
let scale = 4;
let offsetX = 0;
let offsetY = 0;

// =============================================================================
// FILE LOADING
// =============================================================================

document.getElementById('fileInput').addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = (event) => {
            spriteSheet = new Image();
            spriteSheet.onload = () => {
                console.log(`Loaded: ${spriteSheet.width}x${spriteSheet.height}`);
                document.getElementById('sheetOverview').style.display = 'block';
                document.getElementById('sheetThumb').src = spriteSheet.src;
                updateFrameStrip();
                render();
            };
            spriteSheet.src = event.target.result;
        };
        reader.readAsDataURL(file);
    }
});

// Load default player.png
const defaultSheet = new Image();
defaultSheet.onload = () => {
    spriteSheet = defaultSheet;
    document.getElementById('sheetOverview').style.display = 'block';
    document.getElementById('sheetThumb').src = spriteSheet.src;
    updateFrameStrip();
    render();
};
defaultSheet.src = 'player.png';

// =============================================================================
// CONTROLS
// =============================================================================

// Grid controls
document.getElementById('cols').addEventListener('input', (e) => {
    cols = parseInt(e.target.value);
    document.getElementById('colsValue').textContent = cols;
    document.getElementById('totalFrames').textContent = cols;
    updateFrameStrip();
    render();
});

document.getElementById('rows').addEventListener('input', (e) => {
    rows = parseInt(e.target.value);
    document.getElementById('rowsValue').textContent = rows;
    updateRowButtons();
    updateFrameStrip();
    render();
});

// Row selection
document.getElementById('rowButtons').addEventListener('click', (e) => {
    if (e.target.classList.contains('btn')) {
        document.querySelectorAll('#rowButtons .btn').forEach(b => b.classList.remove('active'));
        e.target.classList.add('active');
        currentRow = parseInt(e.target.dataset.row);
        currentFrame = 0;
        updateActionName();
        updateFrameStrip();
        render();
    }
});

function updateRowButtons() {
    const container = document.getElementById('rowButtons');
    const labels = ['Idle', 'Run', 'Jump', 'Row 4', 'Row 5', 'Row 6', 'Row 7', 'Row 8'];
    container.innerHTML = '';
    for (let i = 0; i < rows; i++) {
        const btn = document.createElement('button');
        btn.className = 'btn' + (i === currentRow ? ' active' : '');
        btn.dataset.row = i;
        btn.textContent = labels[i] || `Row ${i + 1}`;
        container.appendChild(btn);
    }
}

function updateActionName() {
    const names = ['IDLE', 'RUN', 'JUMP', 'ROW 4', 'ROW 5', 'ROW 6'];
    document.getElementById('actionName').textContent = names[currentRow] || `ROW ${currentRow + 1}`;
}

// Speed control
document.getElementById('speed').addEventListener('input', (e) => {
    speed = parseInt(e.target.value);
    document.getElementById('speedValue').textContent = speed;
    if (isPlaying) {
        stopPlayback();
        startPlayback();
    }
});

// Scale control
document.getElementById('scale').addEventListener('input', (e) => {
    scale = parseInt(e.target.value);
    document.getElementById('scaleValue').textContent = scale + 'x';
    render();
});

// Offset controls
document.getElementById('offsetX').addEventListener('input', (e) => {
    offsetX = parseInt(e.target.value);
    document.getElementById('offsetXValue').textContent = offsetX;
    render();
});

document.getElementById('offsetY').addEventListener('input', (e) => {
    offsetY = parseInt(e.target.value);
    document.getElementById('offsetYValue').textContent = offsetY;
    render();
});

// Playback controls
document.getElementById('playPause').addEventListener('click', () => {
    if (isPlaying) {
        stopPlayback();
    } else {
        startPlayback();
    }
});

document.getElementById('prevFrame').addEventListener('click', () => {
    stopPlayback();
    currentFrame = (currentFrame - 1 + cols) % cols;
    render();
});

document.getElementById('nextFrame').addEventListener('click', () => {
    stopPlayback();
    currentFrame = (currentFrame + 1) % cols;
    render();
});

function startPlayback() {
    isPlaying = true;
    document.getElementById('playPause').textContent = '‚è∏';
    document.getElementById('playPause').classList.add('playing');
    playInterval = setInterval(() => {
        currentFrame = (currentFrame + 1) % cols;
        render();
    }, speed);
}

function stopPlayback() {
    isPlaying = false;
    document.getElementById('playPause').textContent = '‚ñ∂';
    document.getElementById('playPause').classList.remove('playing');
    if (playInterval) {
        clearInterval(playInterval);
        playInterval = null;
    }
}

// Copy config
document.getElementById('copyConfig').addEventListener('click', () => {
    const config = getExportConfig();
    navigator.clipboard.writeText(config).then(() => {
        document.getElementById('copyConfig').textContent = '‚úì Copied!';
        setTimeout(() => {
            document.getElementById('copyConfig').textContent = 'üìã Copy Config';
        }, 2000);
    });
});

// =============================================================================
// FRAME STRIP
// =============================================================================

function updateFrameStrip() {
    const container = document.getElementById('frameStrip');
    container.innerHTML = '';

    if (!spriteSheet) return;

    const frameW = spriteSheet.width / cols;
    const frameH = spriteSheet.height / rows;

    for (let i = 0; i < cols; i++) {
        const thumb = document.createElement('div');
        thumb.className = 'frame-thumb' + (i === currentFrame ? ' active' : '');
        thumb.dataset.frame = i;

        const canvas = document.createElement('canvas');
        canvas.width = 40;
        canvas.height = 40;
        const tctx = canvas.getContext('2d');
        tctx.imageSmoothingEnabled = false;

        // Draw scaled frame
        const fitScale = Math.min(40 / frameW, 40 / frameH);
        const drawW = frameW * fitScale;
        const drawH = frameH * fitScale;
        tctx.drawImage(
            spriteSheet,
            i * frameW, currentRow * frameH, frameW, frameH,
            (40 - drawW) / 2, (40 - drawH) / 2, drawW, drawH
        );

        thumb.appendChild(canvas);
        thumb.addEventListener('click', () => {
            stopPlayback();
            currentFrame = i;
            render();
        });

        container.appendChild(thumb);
    }
}

// =============================================================================
// RENDERING
// =============================================================================

function render() {
    if (!spriteSheet) {
        ctx.fillStyle = '#333';
        ctx.fillRect(0, 0, preview.width, preview.height);
        ctx.fillStyle = '#666';
        ctx.font = '16px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('Load a sprite sheet', preview.width / 2, preview.height / 2);
        return;
    }

    const frameW = spriteSheet.width / cols;
    const frameH = spriteSheet.height / rows;

    // Resize canvas based on scale
    const displayW = frameW * scale;
    const displayH = frameH * scale;
    preview.width = Math.max(256, displayW + 64);
    preview.height = Math.max(256, displayH + 64);

    // Clear
    ctx.fillStyle = '#1a1a1a';
    ctx.fillRect(0, 0, preview.width, preview.height);

    // Draw checkerboard
    const checkSize = 16;
    for (let y = 0; y < preview.height; y += checkSize) {
        for (let x = 0; x < preview.width; x += checkSize) {
            ctx.fillStyle = ((x + y) / checkSize) % 2 === 0 ? '#222' : '#2a2a2a';
            ctx.fillRect(x, y, checkSize, checkSize);
        }
    }

    // Draw frame
    ctx.imageSmoothingEnabled = false;
    const drawX = (preview.width - displayW) / 2 + offsetX * scale;
    const drawY = (preview.height - displayH) / 2 + offsetY * scale;

    ctx.drawImage(
        spriteSheet,
        currentFrame * frameW, currentRow * frameH, frameW, frameH,
        drawX, drawY, displayW, displayH
    );

    // Update UI
    document.getElementById('frameNum').textContent = currentFrame;
    document.getElementById('totalFrames').textContent = cols;

    // Update frame strip selection
    document.querySelectorAll('.frame-thumb').forEach((thumb, i) => {
        thumb.classList.toggle('active', i === currentFrame);
    });

    // Update highlight on overview
    updateHighlight(frameW, frameH);

    // Update export config
    updateExportConfig();
}

function updateHighlight(frameW, frameH) {
    const thumb = document.getElementById('sheetThumb');
    const highlight = document.getElementById('frameHighlight');

    if (!thumb.complete || thumb.naturalWidth === 0) return;

    const scaleX = thumb.clientWidth / spriteSheet.width;
    const scaleY = thumb.clientHeight / spriteSheet.height;

    highlight.style.left = (15 + currentFrame * frameW * scaleX) + 'px';
    highlight.style.top = (15 + currentRow * frameH * scaleY) + 'px';
    highlight.style.width = (frameW * scaleX) + 'px';
    highlight.style.height = (frameH * scaleY) + 'px';
}

function updateExportConfig() {
    if (!spriteSheet) return;

    const frameW = Math.round(spriteSheet.width / cols);
    const frameH = Math.round(spriteSheet.height / rows);

    document.getElementById('exportValues').innerHTML = `<span class="key">COLS:</span> <span class="val">${cols}</span>
<span class="key">ROWS:</span> <span class="val">${rows}</span>
<span class="key">FRAME_W:</span> <span class="val">${frameW}px</span>
<span class="key">FRAME_H:</span> <span class="val">${frameH}px</span>
<span class="key">SCALE:</span> <span class="val">${scale}x</span>
<span class="key">SPEED:</span> <span class="val">${speed}ms</span>

<span class="key">// For game code:</span>
const COLS = ${cols};
const ROWS = ${rows};
const frameW = img.width / COLS;
const frameH = img.height / ROWS;`;
}

function getExportConfig() {
    if (!spriteSheet) return '';
    const frameW = Math.round(spriteSheet.width / cols);
    const frameH = Math.round(spriteSheet.height / rows);
    return `// Sprite Config
const SPRITE_COLS = ${cols};
const SPRITE_ROWS = ${rows};
const FRAME_WIDTH = ${frameW};
const FRAME_HEIGHT = ${frameH};
const ANIM_SPEED = ${speed}; // ms per frame
const DISPLAY_SCALE = ${scale};`;
}

// Keyboard shortcuts
document.addEventListener('keydown', (e) => {
    if (e.code === 'Space') {
        e.preventDefault();
        document.getElementById('playPause').click();
    } else if (e.code === 'ArrowLeft') {
        document.getElementById('prevFrame').click();
    } else if (e.code === 'ArrowRight') {
        document.getElementById('nextFrame').click();
    } else if (e.code === 'ArrowUp') {
        if (currentRow > 0) {
            currentRow--;
            updateActionName();
            updateFrameStrip();
            render();
        }
    } else if (e.code === 'ArrowDown') {
        if (currentRow < rows - 1) {
            currentRow++;
            updateActionName();
            updateFrameStrip();
            render();
        }
    }
});

// Initial render
render();

console.log('%c SPRITE VIEWER ', 'background: #f1c40f; color: #000; font-weight: bold; padding: 4px 8px;');
console.log('Shortcuts: Space=Play/Pause, Arrows=Navigate frames/rows');
    </script>
</body>
</html>
