<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sprite Viewer</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; overflow: hidden; }
        body {
            background: #1a1a2e;
            color: #e0e0e0;
            font-family: system-ui, sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding: 15px;
            gap: 15px;
        }

        /* Header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }
        header h1 { font-size: 16px; color: #f1c40f; text-transform: uppercase; letter-spacing: 2px; }
        .file-btn {
            padding: 8px 16px;
            background: #f1c40f;
            border: none;
            border-radius: 4px;
            color: #000;
            font-weight: bold;
            cursor: pointer;
            font-size: 12px;
        }
        #fileInput { display: none; }

        /* Main Area */
        .main {
            display: flex;
            gap: 15px;
            flex: 1;
            min-height: 0;
        }

        /* Preview */
        .preview-col {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-width: 0;
        }
        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }
        .preview-header .info { font-size: 14px; }
        .preview-header .action { color: #f1c40f; font-weight: bold; }
        .preview-header .frame { color: #888; font-family: monospace; margin-left: 10px; }
        .zoom-ctrl {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #16213e;
            padding: 4px 8px;
            border-radius: 4px;
        }
        .zoom-ctrl span { font-family: monospace; font-size: 12px; width: 30px; text-align: center; }
        .zoom-btn {
            width: 24px; height: 24px;
            background: #0f0f1a;
            border: 1px solid #333;
            border-radius: 3px;
            color: #fff;
            cursor: pointer;
        }
        .zoom-btn:hover { border-color: #f1c40f; }

        .canvas-wrap {
            flex: 1;
            background: repeating-conic-gradient(#222 0% 25%, #2a2a2a 0% 50%) 50% / 20px 20px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            min-height: 0;
        }
        #preview { image-rendering: pixelated; max-width: 100%; max-height: 100%; }

        /* Frame Strip */
        .frame-strip {
            display: flex;
            gap: 6px;
            padding: 8px;
            background: #16213e;
            border-radius: 4px;
            flex-shrink: 0;
            overflow-x: auto;
        }
        .frame-thumb {
            flex-shrink: 0;
            width: 50px; height: 50px;
            background: #0f0f1a;
            border: 2px solid #333;
            border-radius: 3px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .frame-thumb:hover { border-color: #555; }
        .frame-thumb.active { border-color: #f1c40f; }
        .frame-thumb canvas { image-rendering: pixelated; }

        /* Controls Column */
        .ctrl-col {
            width: 280px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex-shrink: 0;
        }
        .card {
            background: #16213e;
            border-radius: 6px;
            padding: 12px;
        }
        .card h3 {
            font-size: 10px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        /* Grid inputs */
        .grid-row {
            display: flex;
            gap: 10px;
        }
        .grid-row label {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
            font-size: 10px;
            color: #666;
        }
        .grid-row input {
            padding: 6px;
            background: #0f0f1a;
            border: 1px solid #333;
            border-radius: 3px;
            color: #fff;
            font-family: monospace;
            text-align: center;
        }
        .grid-row input:focus { outline: none; border-color: #f1c40f; }

        /* Sheet thumb */
        .sheet-wrap {
            margin-top: 8px;
            position: relative;
            line-height: 0;
        }
        #sheetThumb { max-width: 100%; image-rendering: pixelated; border-radius: 3px; opacity: 0.8; }
        .highlight {
            position: absolute;
            border: 2px solid #f1c40f;
            box-shadow: 0 0 8px rgba(241,196,15,0.5);
            pointer-events: none;
        }

        /* Row buttons */
        .row-btns { display: flex; gap: 6px; flex-wrap: wrap; }
        .row-btn {
            flex: 1;
            min-width: 60px;
            padding: 6px 10px;
            background: #0f0f1a;
            border: 1px solid #333;
            border-radius: 3px;
            color: #fff;
            cursor: pointer;
            font-size: 11px;
            text-transform: uppercase;
        }
        .row-btn:hover { border-color: #555; }
        .row-btn.active { background: #f1c40f; color: #000; border-color: #f1c40f; }

        /* Playback */
        .play-row { display: flex; gap: 6px; }
        .play-btn {
            flex: 1;
            padding: 10px;
            background: #0f0f1a;
            border: 1px solid #333;
            border-radius: 3px;
            color: #fff;
            cursor: pointer;
            font-size: 14px;
        }
        .play-btn:hover { border-color: #f1c40f; }
        .play-btn.playing { background: #27ae60; border-color: #27ae60; }

        .slider-row { margin-top: 8px; }
        .slider-label { display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 4px; }
        .slider-label .val { color: #f1c40f; font-family: monospace; }
        input[type="range"] {
            -webkit-appearance: none;
            width: 100%; height: 4px;
            background: #0f0f1a;
            border-radius: 2px;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px; height: 14px;
            background: #f1c40f;
            border-radius: 50%;
            cursor: pointer;
        }

        /* Export */
        .export-box {
            background: #0f0f1a;
            padding: 8px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 10px;
            color: #888;
        }
        .export-box .k { color: #f1c40f; }
        .export-box .v { color: #2ecc71; }
        .copy-btn {
            width: 100%;
            margin-top: 8px;
            padding: 8px;
            background: #0f0f1a;
            border: 1px solid #333;
            border-radius: 3px;
            color: #fff;
            cursor: pointer;
            font-size: 11px;
        }
        .copy-btn:hover { border-color: #f1c40f; }
    </style>
</head>
<body>
    <header>
        <h1>Sprite Viewer</h1>
        <label class="file-btn">Load Sheet<input type="file" id="fileInput" accept="image/*"></label>
    </header>

    <div class="main">
        <div class="preview-col">
            <div class="preview-header">
                <div class="info">
                    <span class="action" id="actionName">IDLE</span>
                    <span class="frame">Frame <span id="frameNum">0</span>/<span id="totalFrames">4</span></span>
                </div>
                <div class="zoom-ctrl">
                    <button class="zoom-btn" id="zoomOut">-</button>
                    <span id="zoomLevel">4x</span>
                    <button class="zoom-btn" id="zoomIn">+</button>
                </div>
            </div>
            <div class="canvas-wrap">
                <canvas id="preview"></canvas>
            </div>
            <div class="frame-strip" id="frameStrip"></div>
        </div>

        <div class="ctrl-col">
            <div class="card">
                <h3>Grid</h3>
                <div class="grid-row">
                    <label>Cols<input type="number" id="cols" value="4" min="1" max="16"></label>
                    <label>Rows<input type="number" id="rows" value="3" min="1" max="16"></label>
                </div>
                <div class="sheet-wrap" id="sheetWrap" style="display:none">
                    <img id="sheetThumb" src="">
                    <div class="highlight" id="highlight"></div>
                </div>
            </div>

            <div class="card">
                <h3>Row</h3>
                <div class="row-btns" id="rowBtns">
                    <button class="row-btn active" data-row="0">Idle</button>
                    <button class="row-btn" data-row="1">Run</button>
                    <button class="row-btn" data-row="2">Jump</button>
                </div>
            </div>

            <div class="card">
                <h3>Playback</h3>
                <div class="play-row">
                    <button class="play-btn" id="prev">⏮</button>
                    <button class="play-btn" id="play">▶</button>
                    <button class="play-btn" id="next">⏭</button>
                </div>
                <div class="slider-row">
                    <div class="slider-label"><span>Speed</span><span class="val" id="speedVal">150ms</span></div>
                    <input type="range" id="speed" min="50" max="500" value="150" step="10">
                </div>
            </div>

            <div class="card">
                <h3>Export</h3>
                <div class="export-box" id="exportBox">Load sprite sheet...</div>
                <button class="copy-btn" id="copyBtn">Copy Config</button>
            </div>
        </div>
    </div>

<script>
const canvas = document.getElementById('preview');
const ctx = canvas.getContext('2d');
ctx.imageSmoothingEnabled = false;

let img = null, row = 0, frame = 0, playing = false, interval = null;
let cols = 4, rows = 3, speed = 150, scale = 4;

// Load file
document.getElementById('fileInput').onchange = e => {
    const f = e.target.files[0]; if (!f) return;
    const r = new FileReader();
    r.onload = ev => { loadImage(ev.target.result); };
    r.readAsDataURL(f);
};

// Load default
loadImage('player.png');

function loadImage(src) {
    const i = new Image();
    i.onload = () => { img = i; document.getElementById('sheetWrap').style.display='block'; document.getElementById('sheetThumb').src=img.src; update(); };
    i.src = src;
}

// Controls
document.getElementById('cols').onchange = e => { cols = Math.max(1,+e.target.value||1); frame = Math.min(frame,cols-1); update(); };
document.getElementById('rows').onchange = e => { rows = Math.max(1,+e.target.value||1); row = Math.min(row,rows-1); updateRowBtns(); update(); };
document.getElementById('rowBtns').onclick = e => { if (!e.target.dataset.row) return; row = +e.target.dataset.row; frame = 0; update(); };
document.getElementById('zoomIn').onclick = () => { if (scale<12) { scale++; update(); } };
document.getElementById('zoomOut').onclick = () => { if (scale>1) { scale--; update(); } };
document.getElementById('prev').onclick = () => { stop(); frame = (frame-1+cols)%cols; update(); };
document.getElementById('next').onclick = () => { stop(); frame = (frame+1)%cols; update(); };
document.getElementById('play').onclick = () => playing ? stop() : start();
document.getElementById('speed').oninput = e => { speed = +e.target.value; document.getElementById('speedVal').textContent = speed+'ms'; if (playing) { stop(); start(); } };
document.getElementById('copyBtn').onclick = () => {
    if (!img) return;
    const fw = Math.round(img.width/cols), fh = Math.round(img.height/rows);
    navigator.clipboard.writeText(`const COLS=${cols}, ROWS=${rows}, FRAME_W=${fw}, FRAME_H=${fh}, SPEED=${speed};`);
    document.getElementById('copyBtn').textContent = 'Copied!';
    setTimeout(() => document.getElementById('copyBtn').textContent = 'Copy Config', 1500);
};

// Keyboard
document.onkeydown = e => {
    if (e.target.tagName === 'INPUT') return;
    if (e.code === 'Space') { e.preventDefault(); playing ? stop() : start(); }
    else if (e.code === 'ArrowLeft') { stop(); frame = (frame-1+cols)%cols; update(); }
    else if (e.code === 'ArrowRight') { stop(); frame = (frame+1)%cols; update(); }
    else if (e.code === 'ArrowUp' && row > 0) { row--; frame = 0; update(); }
    else if (e.code === 'ArrowDown' && row < rows-1) { row++; frame = 0; update(); }
};

function start() {
    playing = true;
    document.getElementById('play').textContent = '⏸';
    document.getElementById('play').classList.add('playing');
    interval = setInterval(() => { frame = (frame+1)%cols; update(); }, speed);
}
function stop() {
    playing = false;
    document.getElementById('play').textContent = '▶';
    document.getElementById('play').classList.remove('playing');
    if (interval) { clearInterval(interval); interval = null; }
}

function updateRowBtns() {
    const labels = ['Idle','Run','Jump','Row4','Row5','Row6','Row7','Row8'];
    const c = document.getElementById('rowBtns');
    c.innerHTML = '';
    for (let i = 0; i < rows; i++) {
        const b = document.createElement('button');
        b.className = 'row-btn' + (i === row ? ' active' : '');
        b.dataset.row = i;
        b.textContent = labels[i] || 'Row'+(i+1);
        c.appendChild(b);
    }
}

function update() {
    render();
    updateStrip();
    updateUI();
    updateHighlight();
    updateExport();
}

function render() {
    if (!img) { canvas.width=200; canvas.height=200; ctx.fillStyle='#333'; ctx.fillRect(0,0,200,200); return; }
    const fw = img.width/cols, fh = img.height/rows;
    const dw = fw*scale, dh = fh*scale;
    canvas.width = dw; canvas.height = dh;
    ctx.imageSmoothingEnabled = false;
    ctx.drawImage(img, frame*fw, row*fh, fw, fh, 0, 0, dw, dh);
}

function updateStrip() {
    const c = document.getElementById('frameStrip');
    c.innerHTML = '';
    if (!img) return;
    const fw = img.width/cols, fh = img.height/rows;
    for (let i = 0; i < cols; i++) {
        const d = document.createElement('div');
        d.className = 'frame-thumb' + (i === frame ? ' active' : '');
        const cv = document.createElement('canvas');
        cv.width = 40; cv.height = 40;
        const tc = cv.getContext('2d');
        tc.imageSmoothingEnabled = false;
        const s = Math.min(40/fw, 40/fh);
        tc.drawImage(img, i*fw, row*fh, fw, fh, (40-fw*s)/2, (40-fh*s)/2, fw*s, fh*s);
        d.appendChild(cv);
        d.onclick = () => { stop(); frame = i; update(); };
        c.appendChild(d);
    }
}

function updateUI() {
    const labels = ['IDLE','RUN','JUMP','ROW4','ROW5','ROW6'];
    document.getElementById('actionName').textContent = labels[row] || 'ROW'+(row+1);
    document.getElementById('frameNum').textContent = frame;
    document.getElementById('totalFrames').textContent = cols;
    document.getElementById('zoomLevel').textContent = scale+'x';
    document.querySelectorAll('.row-btn').forEach((b,i) => b.classList.toggle('active', i===row));
}

function updateHighlight() {
    if (!img) return;
    const t = document.getElementById('sheetThumb');
    const h = document.getElementById('highlight');
    if (!t.complete) return;
    const fw = img.width/cols, fh = img.height/rows;
    const sx = t.clientWidth/img.width, sy = t.clientHeight/img.height;
    h.style.left = (frame*fw*sx)+'px';
    h.style.top = (row*fh*sy)+'px';
    h.style.width = (fw*sx)+'px';
    h.style.height = (fh*sy)+'px';
}

function updateExport() {
    if (!img) { document.getElementById('exportBox').textContent = 'Load sprite sheet...'; return; }
    const fw = Math.round(img.width/cols), fh = Math.round(img.height/rows);
    document.getElementById('exportBox').innerHTML = `<span class="k">COLS:</span> <span class="v">${cols}</span>  <span class="k">ROWS:</span> <span class="v">${rows}</span><br><span class="k">FRAME:</span> <span class="v">${fw}x${fh}</span>  <span class="k">SPEED:</span> <span class="v">${speed}ms</span>`;
}

update();
</script>
</body>
</html>
