<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sprite Sheet Viewer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #1a1a2e;
            color: #e0e0e0;
            font-family: 'Segoe UI', system-ui, sans-serif;
            min-height: 100vh;
            padding: 20px;
        }

        .app {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #333;
        }

        header h1 {
            font-size: 20px;
            color: #f1c40f;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .file-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #f1c40f 0%, #f39c12 100%);
            border: none;
            border-radius: 4px;
            color: #000;
            font-weight: bold;
            cursor: pointer;
            font-size: 14px;
        }

        .file-btn:hover {
            filter: brightness(1.1);
        }

        #fileInput {
            display: none;
        }

        /* Main Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 20px;
        }

        /* Preview Section */
        .preview-section {
            background: #0f0f1a;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #333;
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .preview-header .action-name {
            font-size: 18px;
            color: #f1c40f;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .preview-header .frame-info {
            font-family: monospace;
            color: #888;
        }

        .zoom-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #16213e;
            padding: 5px 10px;
            border-radius: 4px;
        }

        .zoom-controls span {
            font-family: monospace;
            font-size: 12px;
            min-width: 40px;
            text-align: center;
        }

        .zoom-btn {
            width: 28px;
            height: 28px;
            background: #0f0f1a;
            border: 1px solid #333;
            border-radius: 4px;
            color: #fff;
            cursor: pointer;
            font-size: 16px;
        }

        .zoom-btn:hover {
            border-color: #f1c40f;
        }

        .canvas-container {
            background:
                linear-gradient(45deg, #222 25%, transparent 25%),
                linear-gradient(-45deg, #222 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #222 75%),
                linear-gradient(-45deg, transparent 75%, #222 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            background-color: #1a1a1a;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 300px;
            overflow: hidden;
        }

        #preview {
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        /* Frame Strip */
        .frame-strip {
            display: flex;
            gap: 8px;
            margin-top: 15px;
            padding: 10px;
            background: #16213e;
            border-radius: 4px;
            overflow-x: auto;
        }

        .frame-thumb {
            flex-shrink: 0;
            width: 60px;
            height: 60px;
            background: #0f0f1a;
            border: 2px solid #333;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .frame-thumb:hover {
            border-color: #555;
        }

        .frame-thumb.active {
            border-color: #f1c40f;
            box-shadow: 0 0 10px rgba(241, 196, 15, 0.3);
        }

        .frame-thumb canvas {
            image-rendering: pixelated;
        }

        .frame-thumb .frame-num {
            position: absolute;
            bottom: 2px;
            right: 4px;
            font-size: 10px;
            color: #666;
            font-family: monospace;
        }

        /* Controls Panel */
        .controls-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .control-card {
            background: #16213e;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #333;
        }

        .control-card h3 {
            font-size: 11px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }

        /* Row Buttons */
        .row-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .row-btn {
            flex: 1;
            min-width: 70px;
            padding: 8px 12px;
            background: #0f0f1a;
            border: 1px solid #333;
            border-radius: 4px;
            color: #fff;
            cursor: pointer;
            font-size: 12px;
            text-transform: uppercase;
        }

        .row-btn:hover {
            border-color: #555;
        }

        .row-btn.active {
            background: #f1c40f;
            color: #000;
            border-color: #f1c40f;
        }

        /* Playback Controls */
        .playback-row {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .play-btn {
            flex: 1;
            padding: 12px;
            background: #0f0f1a;
            border: 1px solid #333;
            border-radius: 4px;
            color: #fff;
            cursor: pointer;
            font-size: 16px;
        }

        .play-btn:hover {
            border-color: #f1c40f;
        }

        .play-btn.playing {
            background: #27ae60;
            border-color: #27ae60;
        }

        /* Sliders */
        .slider-group {
            margin-top: 10px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            margin-bottom: 6px;
        }

        .slider-label .value {
            color: #f1c40f;
            font-family: monospace;
        }

        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            background: #0f0f1a;
            border-radius: 3px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #f1c40f;
            border-radius: 50%;
            cursor: pointer;
        }

        /* Grid Settings */
        .grid-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .grid-input {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .grid-input label {
            font-size: 11px;
            color: #888;
        }

        .grid-input input {
            padding: 8px;
            background: #0f0f1a;
            border: 1px solid #333;
            border-radius: 4px;
            color: #fff;
            font-family: monospace;
            font-size: 14px;
            width: 100%;
            text-align: center;
        }

        .grid-input input:focus {
            outline: none;
            border-color: #f1c40f;
        }

        /* Sheet Overview */
        .sheet-thumb-container {
            margin-top: 10px;
            position: relative;
            display: inline-block;
        }

        #sheetThumb {
            max-width: 100%;
            height: auto;
            image-rendering: pixelated;
            border-radius: 4px;
            opacity: 0.8;
        }

        .frame-highlight {
            position: absolute;
            border: 2px solid #f1c40f;
            pointer-events: none;
            box-shadow: 0 0 10px rgba(241, 196, 15, 0.5);
        }

        /* Export */
        .export-code {
            background: #0f0f1a;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 11px;
            color: #888;
            white-space: pre;
            overflow-x: auto;
        }

        .export-code .key { color: #f1c40f; }
        .export-code .val { color: #2ecc71; }

        .copy-btn {
            width: 100%;
            margin-top: 10px;
            padding: 10px;
            background: #0f0f1a;
            border: 1px solid #333;
            border-radius: 4px;
            color: #fff;
            cursor: pointer;
            font-size: 12px;
        }

        .copy-btn:hover {
            border-color: #f1c40f;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <header>
            <h1>Sprite Viewer</h1>
            <label class="file-btn">
                Load Sprite Sheet
                <input type="file" id="fileInput" accept="image/*">
            </label>
        </header>

        <div class="main-grid">
            <!-- Left: Preview -->
            <div class="preview-section">
                <div class="preview-header">
                    <div>
                        <span class="action-name" id="actionName">IDLE</span>
                        <span class="frame-info">Frame <span id="frameNum">0</span>/<span id="totalFrames">4</span></span>
                    </div>
                    <div class="zoom-controls">
                        <button class="zoom-btn" id="zoomOut">-</button>
                        <span id="zoomLevel">4x</span>
                        <button class="zoom-btn" id="zoomIn">+</button>
                    </div>
                </div>
                <div class="canvas-container">
                    <canvas id="preview"></canvas>
                </div>
                <div class="frame-strip" id="frameStrip"></div>
            </div>

            <!-- Right: Controls -->
            <div class="controls-panel">
                <!-- Grid Config -->
                <div class="control-card">
                    <h3>Grid Layout</h3>
                    <div class="grid-inputs">
                        <div class="grid-input">
                            <label>Columns</label>
                            <input type="number" id="cols" value="4" min="1" max="16">
                        </div>
                        <div class="grid-input">
                            <label>Rows</label>
                            <input type="number" id="rows" value="3" min="1" max="16">
                        </div>
                    </div>
                    <div class="sheet-thumb-container" id="sheetOverview" style="display:none;">
                        <img id="sheetThumb" src="">
                        <div class="frame-highlight" id="frameHighlight"></div>
                    </div>
                </div>

                <!-- Animation Row -->
                <div class="control-card">
                    <h3>Animation Row</h3>
                    <div class="row-buttons" id="rowButtons">
                        <button class="row-btn active" data-row="0">Idle</button>
                        <button class="row-btn" data-row="1">Run</button>
                        <button class="row-btn" data-row="2">Jump</button>
                    </div>
                </div>

                <!-- Playback -->
                <div class="control-card">
                    <h3>Playback</h3>
                    <div class="playback-row">
                        <button class="play-btn" id="prevFrame">⏮</button>
                        <button class="play-btn" id="playPause">▶</button>
                        <button class="play-btn" id="nextFrame">⏭</button>
                    </div>
                    <div class="slider-group">
                        <div class="slider-label">
                            <span>Speed</span>
                            <span class="value" id="speedValue">150ms</span>
                        </div>
                        <input type="range" id="speed" min="50" max="500" value="150" step="10">
                    </div>
                </div>

                <!-- Export -->
                <div class="control-card">
                    <h3>Export Config</h3>
                    <div class="export-code" id="exportCode">Load a sprite sheet...</div>
                    <button class="copy-btn" id="copyBtn">Copy Config</button>
                </div>
            </div>
        </div>
    </div>

    <script>
const preview = document.getElementById('preview');
const ctx = preview.getContext('2d');
ctx.imageSmoothingEnabled = false;

let spriteSheet = null;
let currentRow = 0;
let currentFrame = 0;
let isPlaying = false;
let playInterval = null;
let cols = 4;
let rows = 3;
let speed = 150;
let scale = 4;

// File Loading
document.getElementById('fileInput').addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (ev) => {
        spriteSheet = new Image();
        spriteSheet.onload = () => {
            document.getElementById('sheetOverview').style.display = 'block';
            document.getElementById('sheetThumb').src = spriteSheet.src;
            updateAll();
        };
        spriteSheet.src = ev.target.result;
    };
    reader.readAsDataURL(file);
});

// Load default
const defaultSheet = new Image();
defaultSheet.onload = () => {
    spriteSheet = defaultSheet;
    document.getElementById('sheetOverview').style.display = 'block';
    document.getElementById('sheetThumb').src = spriteSheet.src;
    updateAll();
};
defaultSheet.src = 'player.png';

// Grid Controls
document.getElementById('cols').addEventListener('change', (e) => {
    cols = Math.max(1, parseInt(e.target.value) || 1);
    e.target.value = cols;
    currentFrame = Math.min(currentFrame, cols - 1);
    updateAll();
});

document.getElementById('rows').addEventListener('change', (e) => {
    rows = Math.max(1, parseInt(e.target.value) || 1);
    e.target.value = rows;
    currentRow = Math.min(currentRow, rows - 1);
    updateRowButtons();
    updateAll();
});

// Row Buttons
document.getElementById('rowButtons').addEventListener('click', (e) => {
    if (!e.target.classList.contains('row-btn')) return;
    document.querySelectorAll('.row-btn').forEach(b => b.classList.remove('active'));
    e.target.classList.add('active');
    currentRow = parseInt(e.target.dataset.row);
    currentFrame = 0;
    updateAll();
});

function updateRowButtons() {
    const labels = ['Idle', 'Run', 'Jump', 'Row 4', 'Row 5', 'Row 6', 'Row 7', 'Row 8'];
    const container = document.getElementById('rowButtons');
    container.innerHTML = '';
    for (let i = 0; i < rows; i++) {
        const btn = document.createElement('button');
        btn.className = 'row-btn' + (i === currentRow ? ' active' : '');
        btn.dataset.row = i;
        btn.textContent = labels[i] || `Row ${i+1}`;
        container.appendChild(btn);
    }
}

// Playback
document.getElementById('playPause').addEventListener('click', togglePlay);
document.getElementById('prevFrame').addEventListener('click', () => { stopPlay(); currentFrame = (currentFrame - 1 + cols) % cols; updateAll(); });
document.getElementById('nextFrame').addEventListener('click', () => { stopPlay(); currentFrame = (currentFrame + 1) % cols; updateAll(); });

document.getElementById('speed').addEventListener('input', (e) => {
    speed = parseInt(e.target.value);
    document.getElementById('speedValue').textContent = speed + 'ms';
    if (isPlaying) { stopPlay(); startPlay(); }
});

function togglePlay() {
    if (isPlaying) stopPlay();
    else startPlay();
}

function startPlay() {
    isPlaying = true;
    document.getElementById('playPause').textContent = '⏸';
    document.getElementById('playPause').classList.add('playing');
    playInterval = setInterval(() => {
        currentFrame = (currentFrame + 1) % cols;
        updateAll();
    }, speed);
}

function stopPlay() {
    isPlaying = false;
    document.getElementById('playPause').textContent = '▶';
    document.getElementById('playPause').classList.remove('playing');
    if (playInterval) { clearInterval(playInterval); playInterval = null; }
}

// Zoom
document.getElementById('zoomIn').addEventListener('click', () => { if (scale < 12) { scale++; updateAll(); } });
document.getElementById('zoomOut').addEventListener('click', () => { if (scale > 1) { scale--; updateAll(); } });

// Copy
document.getElementById('copyBtn').addEventListener('click', () => {
    if (!spriteSheet) return;
    const frameW = Math.round(spriteSheet.width / cols);
    const frameH = Math.round(spriteSheet.height / rows);
    const config = `const SPRITE_COLS = ${cols};\nconst SPRITE_ROWS = ${rows};\nconst FRAME_W = ${frameW};\nconst FRAME_H = ${frameH};\nconst ANIM_SPEED = ${speed};`;
    navigator.clipboard.writeText(config).then(() => {
        document.getElementById('copyBtn').textContent = 'Copied!';
        setTimeout(() => { document.getElementById('copyBtn').textContent = 'Copy Config'; }, 1500);
    });
});

// Keyboard
document.addEventListener('keydown', (e) => {
    if (e.target.tagName === 'INPUT') return;
    if (e.code === 'Space') { e.preventDefault(); togglePlay(); }
    else if (e.code === 'ArrowLeft') { stopPlay(); currentFrame = (currentFrame - 1 + cols) % cols; updateAll(); }
    else if (e.code === 'ArrowRight') { stopPlay(); currentFrame = (currentFrame + 1) % cols; updateAll(); }
    else if (e.code === 'ArrowUp' && currentRow > 0) { currentRow--; currentFrame = 0; updateAll(); }
    else if (e.code === 'ArrowDown' && currentRow < rows - 1) { currentRow++; currentFrame = 0; updateAll(); }
});

// Update Everything
function updateAll() {
    render();
    updateFrameStrip();
    updateUI();
    updateExport();
    updateHighlight();
}

function render() {
    if (!spriteSheet) {
        preview.width = 256;
        preview.height = 256;
        ctx.fillStyle = '#333';
        ctx.fillRect(0, 0, 256, 256);
        ctx.fillStyle = '#666';
        ctx.font = '14px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('Load a sprite sheet', 128, 128);
        return;
    }

    const frameW = spriteSheet.width / cols;
    const frameH = spriteSheet.height / rows;
    const displayW = frameW * scale;
    const displayH = frameH * scale;

    preview.width = displayW;
    preview.height = displayH;
    ctx.imageSmoothingEnabled = false;

    ctx.drawImage(
        spriteSheet,
        currentFrame * frameW, currentRow * frameH, frameW, frameH,
        0, 0, displayW, displayH
    );
}

function updateFrameStrip() {
    const container = document.getElementById('frameStrip');
    container.innerHTML = '';
    if (!spriteSheet) return;

    const frameW = spriteSheet.width / cols;
    const frameH = spriteSheet.height / rows;

    for (let i = 0; i < cols; i++) {
        const thumb = document.createElement('div');
        thumb.className = 'frame-thumb' + (i === currentFrame ? ' active' : '');

        const canvas = document.createElement('canvas');
        canvas.width = 50;
        canvas.height = 50;
        const tctx = canvas.getContext('2d');
        tctx.imageSmoothingEnabled = false;

        const fitScale = Math.min(50 / frameW, 50 / frameH);
        const drawW = frameW * fitScale;
        const drawH = frameH * fitScale;
        tctx.drawImage(spriteSheet, i * frameW, currentRow * frameH, frameW, frameH, (50-drawW)/2, (50-drawH)/2, drawW, drawH);

        thumb.appendChild(canvas);

        const num = document.createElement('span');
        num.className = 'frame-num';
        num.textContent = i;
        thumb.appendChild(num);

        thumb.addEventListener('click', () => { stopPlay(); currentFrame = i; updateAll(); });
        container.appendChild(thumb);
    }
}

function updateUI() {
    const labels = ['IDLE', 'RUN', 'JUMP', 'ROW 4', 'ROW 5', 'ROW 6'];
    document.getElementById('actionName').textContent = labels[currentRow] || `ROW ${currentRow+1}`;
    document.getElementById('frameNum').textContent = currentFrame;
    document.getElementById('totalFrames').textContent = cols;
    document.getElementById('zoomLevel').textContent = scale + 'x';

    document.querySelectorAll('.row-btn').forEach((btn, i) => {
        btn.classList.toggle('active', i === currentRow);
    });
}

function updateExport() {
    if (!spriteSheet) {
        document.getElementById('exportCode').textContent = 'Load a sprite sheet...';
        return;
    }
    const frameW = Math.round(spriteSheet.width / cols);
    const frameH = Math.round(spriteSheet.height / rows);
    document.getElementById('exportCode').innerHTML =
        `<span class="key">COLS:</span> <span class="val">${cols}</span>  <span class="key">ROWS:</span> <span class="val">${rows}</span>\n` +
        `<span class="key">FRAME:</span> <span class="val">${frameW}x${frameH}px</span>\n` +
        `<span class="key">SPEED:</span> <span class="val">${speed}ms</span>`;
}

function updateHighlight() {
    if (!spriteSheet) return;
    const thumb = document.getElementById('sheetThumb');
    const highlight = document.getElementById('frameHighlight');
    if (!thumb.complete || thumb.naturalWidth === 0) return;

    const frameW = spriteSheet.width / cols;
    const frameH = spriteSheet.height / rows;
    const scaleX = thumb.clientWidth / spriteSheet.width;
    const scaleY = thumb.clientHeight / spriteSheet.height;

    highlight.style.left = (currentFrame * frameW * scaleX) + 'px';
    highlight.style.top = (currentRow * frameH * scaleY) + 'px';
    highlight.style.width = (frameW * scaleX) + 'px';
    highlight.style.height = (frameH * scaleY) + 'px';
}

// Initial
updateAll();
    </script>
</body>
</html>
